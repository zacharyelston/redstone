[SERVICE]
    Flush        5
    Daemon       Off
    Log_Level    info
    Parsers_File parsers.conf
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_Port    2020

# Input for Docker logs via file tailing
[INPUT]
    Name             tail
    Tag              docker.*
    Path             /var/lib/docker/containers/*/*.log
    Parser           docker
    Mem_Buf_Limit    5MB
    Skip_Long_Lines  On
    Refresh_Interval 5

# Parse nested JSON in Docker container logs
[FILTER]
    Name             parser
    Match            docker.*
    Key_Name         log
    Parser           json
    Reserve_Data     On

# Add Docker container name identifier
[FILTER]
    Name             lua
    Match            docker.*
    Script           container_name.lua
    Call             cb_extract_container_name

# Extract container details
[FILTER]
    Name             modify
    Match            docker.*
    Rename           log message
    Add              log_source container

# Output to Loki with container service labels
[OUTPUT]
    Name             loki
    Match            *
    Host             loki
    Port             3100
    Labels           job=fluentbit,service=$service,component=$component
    Label_Keys       $service,$component
    Remove_Keys      stream,time
    Line_Format      json
